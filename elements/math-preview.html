<vue-module id="math-preview">
  <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.2.0/katex.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.2.0/katex.min.js">
  </script>

  <style>
    .katex { font-size: 2em !important; }
  </style>

  <template>
    <md-input-container :class="{'md-input-invalid': hasError}" ref="input">
      <label>Math expression goes here</label>
      <md-textarea v-model="math"></md-textarea>

      <span class="md-error" v-show="hasError">{{error}}</span>
    </md-input-container>

    <div v-html="result"></div>
  </template>

  <script>
    Vue.module('math-preview', {
      data: function () {
        return {
          math: '',
          error: '',
          result: '',
        };
      },

      computed: {
        hasError: function () { return this.error.length > 0; },
      },

      watch: {
        math: function () {
          try {
            this.result = katex.renderToString(this.math);
            this.error = ''
          } catch (err) {
            this.result = '';
            this.error = err.message;
          }
        },
      },
    });
  </script>
</vue-module>
