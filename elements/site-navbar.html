<dom-module id="site-navbar">
  <template>
    <style is="custom-style">
      hr {
        border-style: solid;
        border-color: gray;
        border-width: 0.5px;
      }

      paper-menu {
        --paper-menu-background-color: gainsboro;
      }

      .overflow {
        overflow: scroll;
        overflow-x: auto;
        overflow-y: auto;
      }
    </style>

    <paper-header-panel id="header" class="flex">
      <paper-toolbar>
        <paper-icon-button id="toggle" icon="menu" on-click="toggleDrawer"></paper-icon-button>
        <div class="title">BlockByte</div>
      </paper-toolbar>

      <paper-drawer-panel id="drawer">
        <div drawer class="overflow" style="background-color: gainsboro;">
          <paper-menu selectable="link-item">
            <h4 style="text-align: center;">Navigation</h4>
            <link-item target="/">Home</link-item>
            <hr>
            <link-item target="https://feed43.com/4061761183385368.xml">RSS</link-item>
            <link-item target="/tags.html">Tags</link-item>
            <hr>
            <link-item target="/projects.html">Projects</link-item>
            <hr>
            <link-item target="https://github.com/kirbyfan64">GitHub</link-item>
          </paper-menu>
        </div>
        <div main class="overflow" id="site-navbar-main">
          <div id="site-navbar-ins" style="padding: 0em 1em 1em 1em;">
            <p style="color: red;">
              Note that this website has just been completely redesigned. If you
              notice any issues, please report them
              <a href="https://github.com/kirbyfan64/kirbyfan64.github.io/issues">here</a>.
            </p>
          </div>
        </div>
      </paper-drawer-panel>
    </paper-header-panel>
  </template>

  <script>
    Polymer({
      is: 'site-navbar',

      observers: [
        'narrowChanged(drawer.narrow)'
      ],

      ready: function () {
        // XXX: I'm just really, really lazy...

        function nl2a(nl) {
          var ar = [];
          var len = nl.length;
          for (var i=0; i<len; i++) ar.push(nl[i]);
          return ar;
        }

        var pn = this.parentNode;
        var pc = nl2a(pn.children);
        var div = document.createElement('div');

        for (var i=0; i < pc.length; i++) {
          var child = pc[i];
          if (child == this) continue;
          div.appendChild(child);
        }
        pn.innerHTML = '';
        pn.appendChild(this);

        var ins_point = this.$.drawer.
                        queryEffectiveChildren('#site-navbar-main').
                        querySelector('#site-navbar-ins');

        Polymer.dom(ins_point).appendChild(div);

        var $ = this.$;
        function resize() {
          $.toggle.style.visibility = $.drawer.narrow ? 'visible' : 'hidden';
        }
        resize();
        window.addEventListener('resize', resize);
      },

      toggleDrawer: function () { this.$.drawer.togglePanel(); }
    });
  </script>
</dom-module>
